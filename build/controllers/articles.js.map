{"version":3,"sources":["../../src/controllers/articles.js"],"names":["errors","ArticleController","req","res","Article","find","sort","createdAt","then","articles","length","error","status","json","next","findOne","articleSlug","params","article","body","isValid","newArticle","title","description","author","user","username","id","save","Profile","profile","toString","remove","msg","err","likes","filter","like","removeIndex","dislikes","map","item","indexOf","splice","push","newComment","name","avatar","comments","unshift","comment","_id"],"mappings":"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","sourcesContent":["import Article from '../models/Article';\r\nimport Profile from '../models/Profile';\r\nimport ValidateArticleInput from '../validation/articles/articles';\r\n\r\nconst errors = {};\r\nclass ArticleController {\r\n    static async getArticles(req,res){\r\n\r\n        Article.find()\r\n            .sort({ createdAt: -1 })\r\n            .then(articles => {\r\n                if (articles.length === 0) {\r\n                    errors.error = 'This database has no articles';\r\n                    return res.status(200).json(errors);\r\n                }\r\n                res.json(articles);\r\n            });\r\n\r\n    }\r\n\r\n    static async getSingleArticle(req, res, next){\r\n        await Article.findOne({ articleSlug: req.params.articleSlug }).then(\r\n            article => {\r\n                if (!article) {\r\n                    errors.error = 'This article does not exist';\r\n                    return res.status(404).json(errors);\r\n                }\r\n                res.status(200).json(article);\r\n            }\r\n        );\r\n\r\n    }\r\n\r\n    static async createArticle(req, res){\r\n        const { errors, isValid } = ValidateArticleInput(req.body);\r\n        if (!isValid) {\r\n            res.status(400).json(errors);\r\n        }\r\n        const newArticle = new Article({\r\n            title: req.body.title,\r\n            description: req.body.description,\r\n            body: req.body.body,\r\n            author: req.user.username,\r\n            user: req.user.id,\r\n        });\r\n        newArticle.save().then(article => res.status(201).json(article));\r\n\r\n    }\r\n\r\n    static async deleteArticle(req, res) {\r\n        Profile.findOne({ user: req.user.id }).then(profile => {\r\n            Article.findOne({ articleSlug: req.params.articleSlug })\r\n                .then(article => {\r\n                    if (article.user.toString() !== req.user.id) {\r\n                        return res\r\n                            .status(401)\r\n                            .json({ error: 'User is not authorized' });\r\n                    }\r\n                    article\r\n                        .remove()\r\n                        .then(() =>\r\n                            res\r\n                                .status(200)\r\n                                .json({ msg: 'Article successfully deleted' })\r\n                        );\r\n                })\r\n                .catch(err =>\r\n                    res.status(404).json({ error: 'article not found' })\r\n                );\r\n        });\r\n\r\n    }\r\n\r\n    static async likeArticle(req, res) {\r\n        Profile.findOne({ user: req.user.id }).then(profile => {\r\n            Article.findOne({ articleSlug: req.params.articleSlug })\r\n                .then(article => {\r\n                    if (\r\n                        article.likes.filter(\r\n                            like => like.user.toString() === req.user.id\r\n                        ).length > 0\r\n                    ) {\r\n                        return res.status(400).json({\r\n                            error: 'You have already liked this post',\r\n                        });\r\n                    }\r\n                    const removeIndex = article.dislikes\r\n                        .map(item => item.user.toString())\r\n                        .indexOf(req.user.id);\r\n                    article.dislikes.splice(removeIndex, 1);\r\n                    article.likes.push({ user: req.user.id });\r\n                    article\r\n                        .save()\r\n                        .then(article => res.status(201).json(article));\r\n                })\r\n                .catch(err =>\r\n                    res.status(404).json({ error: 'article not found' })\r\n                );\r\n        });\r\n    }\r\n\r\n\r\n    static async unlikeArticle(req, res) {\r\n        Profile.findOne({ user: req.user.id }).then(profile => {\r\n            Article.findOne({ articleSlug: req.params.articleSlug })\r\n                .then(article => {\r\n                    if (\r\n                        article.likes.filter(\r\n                            like => like.user.toString() === req.user.id\r\n                        ).length === 0\r\n                    ) {\r\n                        return res.status(400).json({\r\n                            error: 'You have not yet liked this article',\r\n                        });\r\n                    }\r\n                    const removeIndex = article.likes\r\n                        .map(item => item.user.toString())\r\n                        .indexOf(req.user.id);\r\n                    article.likes.splice(removeIndex, 1);\r\n                    article\r\n                        .save()\r\n                        .then(article => res.status(201).json(article));\r\n                })\r\n                .catch(err =>\r\n                    res.status(404).json({ error: 'article not found' })\r\n                );\r\n        });\r\n\r\n    }\r\n\r\n    static async dislikeArticle(req, res) {\r\n        Profile.findOne({ user: req.user.id }).then(profile => {\r\n            Article.findOne({ articleSlug: req.params.articleSlug })\r\n                .then(article => {\r\n                    if (\r\n                        article.dislikes.filter(\r\n                            like => like.user.toString() === req.user.id\r\n                        ).length > 0\r\n                    ) {\r\n                        return res.status(400).json({\r\n                            error: 'You have already disliked this post',\r\n                        });\r\n                    }\r\n                    const removeIndex = article.likes\r\n                        .map(item => item.user.toString())\r\n                        .indexOf(req.user.id);\r\n                    article.likes.splice(removeIndex, 1);\r\n                    article.dislikes.push({ user: req.user.id });\r\n                    article\r\n                        .save()\r\n                        .then(article => res.status(201).json(article));\r\n                })\r\n                .catch(err =>\r\n                    res.status(404).json({ error: 'article not found' })\r\n                );\r\n        });\r\n    }\r\n\r\n    static async undislikeArticle(req, res) {\r\n        Profile.findOne({ user: req.user.id }).then(profile => {\r\n            Article.findOne({ articleSlug: req.params.articleSlug })\r\n                .then(article => {\r\n                    if (\r\n                        article.dislikes.filter(\r\n                            like => like.user.toString() === req.user.id\r\n                        ).length === 0\r\n                    ) {\r\n                        return res.status(400).json({\r\n                            error: 'You have not yet disliked this article',\r\n                        });\r\n                    }\r\n                    const removeIndex = article.dislikes\r\n                        .map(item => item.user.toString())\r\n                        .indexOf(req.user.id);\r\n                    article.dislikes.splice(removeIndex, 1);\r\n                    article\r\n                        .save()\r\n                        .then(article => res.status(201).json(article));\r\n                })\r\n                .catch(err =>\r\n                    res.status(404).json({ error: 'article not found' })\r\n                );\r\n        });\r\n    }\r\n\r\n    static async commentOnArticle(req, res) {\r\n        Article.findOne({ articleSlug: req.params.articleSlug })\r\n            .then(article => {\r\n                const newComment = {\r\n                    body: req.body.body,\r\n                    name: req.user.username,\r\n                    avatar: req.body.avatar,\r\n                    user: req.user.id,\r\n                };\r\n                article.comments.unshift(newComment);\r\n                article.save().then(article => res.status(200).json(article));\r\n            })\r\n            .catch(err =>\r\n                res.status(404).json({ error: 'article not found ' })\r\n            );\r\n\r\n    }\r\n\r\n    static async deleteComment(req, res) {\r\n        Article.findOne({ articleSlug: req.params.articleSlug })\r\n            .then(article => {\r\n                if (\r\n                    article.comments.filter(\r\n                        comment =>\r\n                            comment._id.toString() === req.params.id\r\n                    ).length === 0\r\n                ) {\r\n                    return res\r\n                        .status(404)\r\n                        .json({ error: 'Comment does not exist' });\r\n                }\r\n                const removeIndex = article.comments.map(item =>\r\n                    item._id.toString()).indexOf(req.params.id);\r\n                article.comments.splice(removeIndex, 1);\r\n                article.save().then(article => res.status(201).json({msg:'Comment successfully deleted'}));\r\n            })\r\n            .catch(err =>\r\n                res.status(404).json({ error: 'article not found ' })\r\n            );\r\n    }\r\n\r\n}\r\n\r\nexport default ArticleController"],"file":"articles.js"}